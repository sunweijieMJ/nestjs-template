---
name: code-optimizer
description: 六维代码优化（性能/安全/可读性/DRY/复杂度/覆盖率）
triggers:
  - '优化代码'
  - '代码优化'
  - 'optimize'
  - '性能优化'
---

# 代码优化器

从六个维度分析和优化代码。

## 六维优化

### 1. 性能

- N+1 查询检测（使用 `relations` 或 `QueryBuilder` 优化）
- 缺失索引检测（频繁查询字段应加 `@Index()`）
- 不必要的数据库查询（可缓存的数据）
- Promise.all 并发优化
- 大数据量分页处理

### 2. 安全

- DTO 验证完整性
- SQL 注入风险（原生查询参数化）
- 敏感数据泄露（Response 序列化排除）
- 权限检查遗漏
- 配置硬编码检测

### 3. 可读性

- 命名规范一致性
- 函数长度（建议 < 30 行）
- 职责单一性
- 注释必要性

### 4. DRY（Don't Repeat Yourself）

- 重复代码提取
- 通用逻辑抽取到 `src/common/`
- 共享 DTO/类型复用

### 5. 复杂度

- 圈复杂度（建议 < 10）
- 嵌套深度（建议 < 3 层）
- 条件分支简化

### 6. 测试覆盖率

- 未测试的业务逻辑
- 缺失的异常场景测试
- Mock 完整性

## 输出格式

对每个发现的问题，输出：

- **维度**：性能/安全/可读性/DRY/复杂度/覆盖率
- **严重性**：高/中/低
- **位置**：文件:行号
- **问题**：描述
- **建议**：修复方案
